{% extends "layoult.html" %} {% block body %}
<div
  class="container d-flex justify-content-center align-items-center min-vh-100"
>
  <div class="row p-3 bg-white shadow box-area mt-5">
    <div
      class="col-md-6 rounded-4 d-flex justify-content-center align-items-center flex-column left-box"
      style="background: #f8ca6b"
    ></div>
    <div id="info-container" class="col-md-6 right-box">
      <div
        id="error-container"
        class="alert alert-danger"
        role="alert"
        style="display: none"
      ></div>
      <!-- <div
        id="success-container"
        class="alert alert-success"
        role="alert"
        style="display: none"
      ></div> -->
      <form
        action="/resend-verification-token"
        method="POST"
        class="row align-items-center justify-content-between"
      >
        <div class="header-text mb-4 text-center">
          <h2>Reenviar token de verificación</h2>
        </div>
        <div class="input-group mb-3">
          <input
            type="email"
            class="form-control form-control-lg bg-light fs-6"
            placeholder="E-mail"
            name="email"
            id="email"
            required
          />
        </div>
        <div class="input-group mb-3">
          <button
            id="btn-resend-token"
            type="submit"
            class="btn btn-lg btn-light w-100 fs-6"
          >
            Reenviar token
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<script>
  const formulario = document.querySelector('form');
  const campoEmail = document.getElementById('email');

  const infoContainer = document.getElementById('info-container');

  const errorMsgContainer = document.getElementById('error-container');
  // const successMsgContainer = document.getElementById('success-container');

  function showErrorMessage(msg) {
    errorMsgContainer.textContent = msg;
    errorMsgContainer.style.display = 'block';
  }

  function showSuccessMessage(msg) {
    errorMsgContainer.style.display = 'none';
    formulario.remove();

    const contenedorTitulo = document.createElement('div');
    contenedorTitulo.classList.add('header-text', 'mb-4', 'text-center');

    const tituloElemento = document.createElement('h2');
    tituloElemento.textContent = 'Confirmación de correo';

    const parrafoInfo = document.createElement('p');
    parrafoInfo.textContent = msg;

    contenedorTitulo.appendChild(tituloElemento);
    infoContainer.appendChild(contenedorTitulo);
    infoContainer.appendChild(parrafoInfo);
  }

  formulario.addEventListener('submit', (e) => {
    // para que no se recargue la pagina
    e.preventDefault();
    fetch(`${location.origin}/resend-verification-token`, {
      method: 'POST',
      mode: 'cors',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ email: campoEmail.value }),
    })
      .then((res) => {
        return res.json();
      })
      .then((data) => {
        const { error, mensaje } = data;
        if (!error) {
          showSuccessMessage(mensaje);
        } else {
          showErrorMessage(mensaje);
        }
      });
  });
</script>
{% endblock %}
